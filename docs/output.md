# nf-core/scflow: Output

## Introduction

This document describes the output produced by the pipeline. 

The directories listed below will be created in the results directory after the pipeline has finished. All paths are relative to the top-level results directory.

<!-- TODO nf-core: Write this documentation describing your workflow's output -->

## Pipeline overview

The pipeline is built using [Nextflow](https://www.nextflow.io/) and processes data using the following steps:

* [Check inputs](#check_inputs) - Checks if all input files are present (`SCFLOW_CHECKINPUTS`)
* [Quality control](#qc) - Quality control of gene-cell matrices (`SCFLOW_QC`)
* [Merged summary](#merged) - Quality control of merged qc tables and merged SingleCellExperiment (SCE) object (`SCFLOW_MERGEQCTABLES` and `SCFLOW_MERGE`)
* [Integration, dimension reduction and clustering](#integration_dimension_reduction) - Integration and dimension reduction of the merged SCE followed by clustering (`SCFLOW_INTEGRATE`, `SCFLOW_REDUCEDIMS`, `SCFLOW_CLUSTER` & `SCFLOW_REPORTINTEGRATED`)
* [Celltype annotation](#celltype_annotation) - Automated cell-type annotation of the clustered SCE and identification of marker genes  (`SCFLOW_MAPCELLTYPES`, `SCFLOW_FINALIZE`)
* [Differential gene expression analysis](#DGE) - Performs differential gene expression analysis and generates result tables and plots (`SCFLOW_DGE`)
* [Impacted pathway analysis](#IPA) - Performs impacted pathway analysis and generates result tables and plots  (`SCFLOW_IPA`)
* [Dirichlet](#dirichlet) - Performs differential analysis of cell-type composition (`SCFLOW_DIRICHLET`)
* [Reports](#reports) - Aggregate report describing results and QC from multiple processes of the pipeline (`SCFLOW_QC`, `SCFLOW_MERGE`, `SCFLOW_REPORTINTEGRATED`, `SCFLOW_FINALIZE`, `SCFLOW_DGE`, `SCFLOW_IPA`, `SCFLOW_DIRICHLET`)
* [Additional plots](#plots) - User-specified gene plots highlighting the cells in reduced dimensionality space 
* [Additional tables](#tables) - Tables of cell-type mappings for each cluster
* [Pipeline information](#pipeline-information) - Report metrics generated during the workflow execution (`GET_SOFTWARE_VERSIONS`)

### Quality control

<details markdown="1">
<summary>Output files</summary>

* `quality_control/`
    * `merged.tsv` : A `.tsv` file containing all qc values from merged samples. 

* `quality_cotrol/<manifest>/`
    * `qc_plot_data` : `.tsv` files for major qc values for plotting.
    * `qc_plots` : `.png` files included in the `.html` reports for major qc steps.
    * `sce/<manifest_sce>/`: Post-qc SCE in gene-cell matrix format along with `.tsv` files for metadata and dimensionality-reduction values.

</details>

### Merged summary

<details markdown="1">
<summary>Output files</summary>

* `merged/`
    * `merged_plots/` : Pseudobulk plots from the `*_scflow_merged_report.html` report.
    * `merge_summary_plots/` : High-resolution plots from the `*_scflow_merged_report.html` report.

</details>

### Integration, dimension reduction and clustering

<details markdown="1">
<summary>Output files</summary>

The output after integration, dimension reduction and clustering is a `.html` report generated by the process `SCFLOW_REPORTINTEGRATED` which can be found in the `reports/` folder.

</details>

### Celltype annotation

<details markdown="1">
<summary>Output files</summary>

* `celltype_markers/celltype_marker_plots/`
    * `*.pdf` : `.pdf` image of the marker gene plots for clusters and cluster_celltype variables.
    * `*.png` : `.png` image of the marker gene plots for clusters and cluster_celltype variables.

* `celltype_markers/celltype_marker_tables/`
    * `*.tsv` : `.tsv` files for all and top n marker genes for clusters and cluster_celltype variables 

* `final/`
    * `SCE/final_sce` : The directory containing the final SCE with all metadata and dimensionality reduction, clustering and cell-type annotation.
    * `celltypes.tsv` : A `.tsv` file giving the final number of all cell-types and number of nuclei/cells per cell-type.
    
</details>

### Differential gene expression analysis

<details markdown="1">
<summary>Output files</summary>

* `DGE/<cluster_celltype>/`
    * `*.tsv` : A `.tsv` file containing all genes with their logFC and padj.
    * `de_plots` : Directory containing the volcano plot used in the `scflow_de_report.html` report.

</details>

### Impacted pathway analysis

<details markdown="1">
<summary>Output files</summary>

* `IPA/<cluster_celltype>/`
    * `<enrichment_tool>/<de_table>/` : Directory containing `.png` image of the top 10 significant impacted pathways and `.tsv` file containing all significantly impacted pathways.
    
</details>

### Dirichlet

<details markdown="1">
<summary>Output files</summary>

Differential cell-type composition analysis is performed in `SCFLOW_DIRICHLET` and the output can be found in the `reports/` folder.
    
</details>

### Reports

<details markdown="1">
<summary>Output files</summary>

* `reports/`
    * `qc/*_scflow_qc_report.html` : Complete qc reports containing post-qc summary, key parameters used, qc plots etc.
    * `merged_report/*_scflow_merged_report.html` : Merged summary reports containing qc from all samples together.
    * `integration_report/integrate_report_scflow.html` : Report giving key parameters used in integration and clustering and plots showing mixedness of the samples/batches to integrate.
    * `celltype_metrics_report/scflow_celltype_metrics_report.html` : Celltype metrics report showing pipeline generated celltype annotation with marker gene plots and tables.
    * `DGE/*scflow_de_report.html` : Individual report for differential expression for each celltype and each contrast specified.
    * `IPA/*scflow_ipa_report.html` : Individual report from impacted pathway analysis containing plots and tables of the enrichment.
    * `dirichlet_report/*dirichlet_report.html` : Dirichlet report for differential celltype proportion.

</details>


### Additional plots

<details markdown="1">
<summary>Output files</summary>

* `plots/reddim_gene_plots`
    * `<plotreddim_reduction_methods>/<celltypes>` : Directories of plots of specified cell-types in the `reddim_genes.yml` file. 

</details>

### Additional tables

<details markdown="1">
<summary>Output files</summary>

* `tables/celltype_mappings/`
    * `celltype_mappings.tsv` : A `.tsv` file with the automated cell-type annotation by process `mapcelltype`.

</details>

### Pipeline information

<details markdown="1">
<summary>Output files</summary>

* `pipeline_info/`
    * Reports generated by Nextflow: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt` and `pipeline_dag.svg`.
    * Reports generated by the pipeline: `software_versions.tsv`.

</details>


[Nextflow](https://www.nextflow.io/docs/latest/tracing.html) provides excellent functionality for generating various reports relevant to the running and execution of the pipeline. This will allow you to troubleshoot errors with the running of the pipeline, and also provide you with other information such as launch commands, run times and resource usage.
